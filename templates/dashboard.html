<!-- render_app/templates/dashboard.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Reddit Insights â€” Dashboard</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="topnav">
    <div class="brand">Reddit Insights</div>
    <div class="navlinks">
      <a href="/chat">Chatbot</a>
    </div>
  </div>

  <main class="main-container">
    <section class="panel">
      <h2>Pinecone Index Status</h2>
      <p class="muted">This dashboard reads index stats directly from Pinecone. The local pipeline uploads embeddings and updates the index.</p>

      <div id="stats" class="card">
        <p>Loading index statistics...</p>
      </div>

      <div id="raw" class="card" style="margin-top:12px;"></div>
    </section>
  </main>

  <script>
    async function loadStats(){
      const r = await fetch('/api/pinecone_stats');
      const j = await r.json();
      const c = document.getElementById('stats');
      if (j.error) {
        c.innerHTML = `<p style="color:darkred">${j.error}</p>`;
        return;
      }
      if (!j.index_exists) {
        c.innerHTML = `<p>Index not found. Local pipeline must create & upload embeddings.</p>`;
        return;
      }
      c.innerHTML = `
        <p><strong>Total vectors:</strong> ${j.total_vectors ?? 'unknown'}</p>
        <p><strong>Dimension:</strong> ${j.dimension}</p>
        <p><strong>Metric:</strong> ${j.metric}</p>
        <p><strong>Namespaces:</strong> ${j.namespaces.join(', ') || 'default'}</p>
      `;
      const raw = document.getElementById('raw');
      raw.innerHTML = `<pre style="white-space:pre-wrap; max-height:200px; overflow:auto;">${JSON.stringify(j.raw_stats, null, 2)}</pre>`;
    }
    loadStats();
  </script>
</body>
</html>
