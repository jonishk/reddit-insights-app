<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reddit Insights â€“ Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="topnav">
        <div class="brand">Reddit Insights Chatbot</div>
    </div>

    <main class="chat-container">

        <div id="chatbox" class="chat-box">
            <!-- Messages will be appended here -->
        </div>

        <form id="chat-form" class="chat-input">
            <input type="text" id="userInput" name="msg" placeholder="Type your message..." autocomplete="off">
            <button type="submit">Send</button>
        </form>

    </main>

    <script>
        const form = document.getElementById("chat-form");
        const chatbox = document.getElementById("chatbox");
        const input = document.getElementById("userInput");

        function appendMessage(sender, text) {
            const msg = document.createElement("div");
            msg.className = sender === "user" ? "msg user-msg" : "msg bot-msg";
            msg.innerText = text;
            chatbox.appendChild(msg);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        form.addEventListener("submit", async function (e) {
            e.preventDefault();
            const message = input.value.trim();
            if (!message) return;

            appendMessage("user", message);
            input.value = "";

            const formData = new FormData();
            formData.append("msg", message);

            appendMessage("bot", "Thinking...");

            const response = await fetch("/get", { method: "POST", body: formData });
            const data = await response.text();

            // Replace the last "Thinking..." bubble
            chatbox.lastChild.textContent = data;
        });
    </script>
</body>
</html>
